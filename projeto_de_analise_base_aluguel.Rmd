---
title: "R Notebook"
output: html_notebook
---


#Carregando pacotes
```{r}
#instalação do pacote "readr"
install.packages("readr")

library(readr)

```


#Importando a base de dados
```{r}
library(readr)
aluguel <- read_delim("C:/Users/dnl49/OneDrive/Curso R 2/aluguel.csv", 
    ";", escape_double = FALSE, trim_ws = TRUE)
View(aluguel)
```


#Entendendo a base de dados
```{r}
str(aluguel)

```

```{r}
head(aluguel)
```

```{r}
install.packages("tidyverse")

library(tidyverse)

str(aluguel)
```
Olhando a estrutura da base de dados
```{r}
glimpse(aluguel)
```

Verificando se a base tem duplicidade
```{r}
aluguel_t = unique(aluguel)

glimpse(aluguel_t)
```
Fazendo a seleção de campos da base de dados
```{r}
select1 = select(aluguel_t, Tipo, Bairro, Quartos, Area, Valor)

glimpse(select1)
```

Outra seleção - retirando campos da base de dados
```{r}
select2 = select(aluguel_t, -IPTU)

glimpse(select2)
```

Usando seleção contendo alguns caracteres
```{r}
select3 = select(aluguel_t, contains("Cond"))

glimpse(select3)
```
Vamos fazer os seguintes filtros na base:

Tipo = Casa
Quartos >= 4
Vagas >= 3
Suites >= 3
Valor <= 15000

```{r}
casas = filter(aluguel_t, Tipo == "Casa")
glimpse(casas)
```
```{r}
casas_f1 = filter(casas, Quartos >= 4, Vagas >= 3, Suites >= 3, Valor <= 15000)
glimpse(casas_f1)
```
Bairros:
Barra da Tijuca
Leblon
```{r}
casas_f2 = filter(casas_f1, Bairro %in% c("Barra da Tijuca", "Leblon"))
glimpse(casas_f2)
```
Ordenar a base de dados
```{r}
library(tidyverse)

arrange(casas_f2)
```


Ordenação decrescente
```{r}
arrange(casas_f2, desc(Valor))
```


Criando novos campos na base de dados (mutate)
```{r}
casas_f2 = mutate(casas_f2, Indicador = (Area/Valor)*100)
casas_f2
```


```{r}
casas_finais = mutate(casas_f2, Visitas = ifelse(Indicador > 5, "OK", "NOK"))
casas_finais
```

```{r}
filter(casas_finais, Visitas == "OK")
```

Combinar o comando filter com o select
```{r}
select(filter(casas_finais, Visitas == "OK"), Area, Valor, Indicador, Visitas)
```

Pacotes
```{r}
library(tidyverse)

install.packages("magrittr")
library(magrittr)
```

Utilização do Pipe %>% Ctrl+Shift+M

#Sem a utilização do Pipe
```{r}
filter(aluguel_t, Tipo == 'Casa')
```

#Com a utilização do Pipe %>%
```{r}
aluguel_t %>%
  filter(Tipo == "Casa")
```

#Sem a utilização do Pipe %>%
```{r}
casas = filter(aluguel_t, Tipo == "Casa")
casas_f1 = filter(casas, Quartos >= 4, Valor <= 15000)
casas_f2 = filter(casas_f1, Bairros = c("Barra da Tijuca", "Leblon"))
casas_f2 = arrange(casas_f2, desc(Valor))
```

#Utilizando o comando Pipe %>%
```{r}
casas_selecionadas = aluguel_t %>%
  filter(Tipo == "Casa", Quartos >= 4, Valor <= 15000, Bairro %in% c("Barra da Tijuca", "Leblon")) %>%
  arrange(desc(Valor))
  
casas_selecionadas
```